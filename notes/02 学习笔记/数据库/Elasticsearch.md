## ES简介
Elasticsearch 是使用 Java 编写并使用 Lucene 来建立索引并实现搜索功能，目的是通过简单连贯的 RESTful API 让全文搜索变得简单并隐藏 Lucene 的复杂性。 
功能：
1. 分布式的实时文件存储，每个字段都被索引并可被搜索
2. 实时分析的分布式搜索引擎
3. 可以扩展到上百台服务器，处理 PB 级结构化或非结构化数据

### 名词区分
1. ES：Elasticsearch简写，是一个开源的高扩展的分布式全文检索引擎

2. ELK：ELK是Elasticsearch , Logstash, Kibana三个开源软件的缩写，业界经常会组合使用这三种技术，来实现分布式系统的日志管理及可视化，所以，这三种技术的组合就被称为“ELK Stack”

3. Elatic Stack：Elastic Stack 是 ELK 的下一个发展版本，它也是 ELK Stack，但具有更大的灵活性。（ELK因个性化用例需求增加催生了很多其他产品，更名为Elastic Stack，用以统称以ELK为核心但技术栈）

索引：
1. 名词：一个 索引 类似于传统关系数据库中的一个 数据库 ，是一个存储关系型文档的地方。 索引 (index) 的复数词为 indices 或 indexes 。
2. 动词：索引一个文档 就是存储一个文档到一个 索引 （名词）中以便被检索和查询。这非常类似于 SQL 语句中的 INSERT 关键词，除了文档已存在时，新文档会替换旧文档情况之外。

3. 倒排索引：是一种索引方法，被用来存储在全文搜索下 某个单词 在一个文档或者一组文档中 的存储位置的映射，value->key（索引是key->value  ）

4. 全文搜索 full-text-search：以文本作为搜索对象，检索含有特定词汇的文本

5. 全文检索 full-text-retrieval：一种先建立索引，再对索引进行搜索的过程：首先将要搜索的目标文档中的词提取出来组成索引，通过查询索引达到搜索目标文档的目的

## ES核心概念
### 1. 接近实时 NRT 
ES 是一个接近实时的搜索平台。即从索引一个文档直到这个文档能够被搜索到有轻微的延迟（通常 1 秒）

### 2. 集群 cluster
一个集群是由一个或多个节点组织在一起，它们共同持有整个数据，并一起提供索引和搜索功能。一个集群由一个唯一的名字标识

### 3. 节点 node 
一个节点是指集群中的一个服务器，作为集群的一部分，用于存储数据，参与集群的索引和搜索功能。
一个节点可以通过配置集群名称的方式来加入一个指定的集群。

### 4. 索引 index 
一个索引是一个拥有几分相似特征的文档的集合。比如一个客户数据的索引，一个产品目录的索引，一个订单数据的索引等。
一个索引由一个名字来标识（必须全部是小写字母的），当需要对应于这个索引中的文档进行索引、搜索、更新和删除的时候，都要使用到这个名字。
索引类似于关系型数据库中 Database 的概念。

### 5. 类型 type 
在一个索引中定义一种或多种类型。一个类型是索引的一个逻辑上的分类/分区，通常会为具有一组共同字段的文档定义一个类型。
类型类似于关系型数据库中 Table 的概念。

### 6. 文档 document 
一个文档是一个可被索引的基础信息单元。文档以 JSON 格式表示，在一个index/type里面，可以存储任意多的文档。
文档类似于关系型数据库中 Record的 概念。文档包括 _index、_type 和 _id 三个默认字段。

### 7. 分片和复制 shards & replicas 
问题1：
一个索引可以存储超出单个结点硬件限制的大量数据。如一个具有 10 亿文档的索引占据 1TB 的磁盘空间，而任一节点都没有这样大的磁盘空间；或者单个节点处理搜索请求，响应太慢。
解决措施：
**分片**：ES 能将索引划分成多份，在创建索引时，可以指定分片数量。每个分片本身也是一个功能完善并且独立的“索引”，这个“索引”可以被放置到集群中的任何节点上。 
1. 可以水平分割/扩展索引的内容容量，ES 中分片的分布和聚合回搜索请求都是有 ES 管理的，对用户而言都是透明的。
2. 可以在分片（潜在地，位于多个节点上）之上进行分布式的、并行的操作，进而提高性能/吞吐量

问题2：
在某个分片/节点突然失效或处于离线状态
解决措施：
**复制**：ES 可以创建分片的一份或多份拷贝，即复制分片，
1. 在分片/节点失败的情况下，提供了高可用性。复制分片不能和原/主要（original/primary）分片置于同一节点上
2. 扩展搜索量/吞吐量，因为搜索可以在所有的复制上并行运行

总结：一个索引可以被分成多个分片，一个索引也可以被复制0次（意思是没有复制）或多次。复制之后每个索引有主分片（作为复制源的原来的分片）和复制分片（主分片的拷贝）的区分。
分片和复制的数量可以在索引创建的时候指定。在索引创建之后，可以在随时修改复制数量，但是不能修改分片数量。

默认情况下，Elasticsearch中的每个索引被分片5个主分片和1个复制，这意味着，如果你的集群中至少有两个节点，你的索引将会有5个主分片和另外5个复制分片（1个完全拷贝），这样的话每个索引总共就有10个分片。一个索引的多个分片可以存放在集群中的一台主机上，也可以存放在多台主机上，这取决于你的集群机器数量。主分片和复制分片的具体位置是由ES内在的策略所决定的。

## mapping
mapping 类似于传统关系型数据中 table 的 schema，用于定义一个 index 的某个 type 中数据的结构。
在传统关系数据库中需要通过 create table 来定义 schema，但在 ES 中，无需手动创建 type 和 mapping，ES 能够根据插入的数据自动创建 type 及其 mapping

mapping 主要包括字段名、字段数据类型和字段索引类型 3 个方面的定义

### ES 支持的字段数据类型
String 大类：string
Whole number 大类：byte, short, integer, long
Floating point 大类：float, double
Boolean 大类：boolean
Date 大类：date

### 字段索引类型
在 ES 中，字段不建立索引的话就不能以这个字段作为查询条件来搜索，即只能起到数据载体的作用。

mapping 中 string 类型字段可以配置的索引类型：
analyzed： 首先分析这个字符串，然后再建立索引，即以全文形式索引此字段。设置为 analyzed，ES 会先对这个字段进行分析（即分词）。
not_analyzed： 索引这个字段，使之可以被搜索，但是索引内容和指定值一样。不分析此字段。
no： 不索引这个字段。这个字段不能被搜索到。

## DSL查询
DSL(Domain Specific Language特定领域语言) 查询是 ES 提供的通用查询方式，通过 JSON 格式来查询数据
特点：与开发语言无关，即任意客户端只要支持 HTTP 请求，就可以通过 JSON 格式的查询数据完成复杂的搜索。

DSL 由两个部分组成：DSL查询，DSL过滤。
1. DSL过滤(精确查找)查询文档的方式更像是对于我的条件“有”或者“没有”
2. DSL查询（模糊查询）则像是“有多像”。

原则上，使用DSL查询做全文本搜索或其他需要进行相关性评分的场景，其它全用DSL过滤。

## ES与关系数据库比较
| DB              | ES|
数据库（database）  |   索引（index）：一组具有相似特性的文档的集合
表（table）        |   类型（type）从6.0.0 版本起已废弃，一个索引中只存放一类数据
行（row）          |   文档（document）：一个可以被索引的基本信息单元
列（column）       |   字段（field）
表结构（schema）    |   映射（mapping）
索引               |    倒排索引
SQL               |    查询DSL
SELECT            |    GET
UPDATE            |    PUT
DELETE            |    DELETE

木星：不建议直接接木星数仓
将木星和太平洋的回访结果接到工单这边，但不展示，数据组从这边拿数据

本期只做数据，两个展示都不做
安装30天从
回访从工单处取