# Linux
<!-- GFM-TOC -->
* [文件操作](#文件操作)
	* [文件与目录基本操作](#文件与目录基本操作)
	* [文件权限](#文件权限)
	* [文档编辑](#文档编辑)
* [linux 三剑客](#linux-三剑客)
	* [grep](#grep)
	* [awk](#awk)
	* [sed](#sed)
* [进程管理](#进程管理)
	* [查看进程](#查看进程)
	* [后台运行](#后台运行)
	* [孤儿进程和僵尸进程](#孤儿进程和僵尸进程)
* [系统管理](#系统管理)
	* [用户管理](#用户管理)
* [磁盘管理](#磁盘管理)
* [其他](#其他)
<!-- GFM-TOC -->

## 文件操作
### 文件与目录基本操作
#### ls
```html
$ ls [-alrtAFR] file|dir
-a 显示所有文件及目录，以'.'开头的不会列出
-l 长模式输出，显示详细信息
-r 相反顺序显示
-t 按照文件修改时间先后排序
```
列出当前目录下所有名称是 s 开头的文件，新的排在后面
```sh
$ ls -ltr s*
```

#### 目录
- mkdir [-mp] dirname 创建目录
- rmdir [-p] dirname 删除目录，只能删除空目录
- pwd 查看当前所在目录，输出绝对路径

-m 配置目录权限；   
-p 递归创建/删除目录。 创建时确保目录名称存在，不存在的就建一个；删除时当子目录被删除后使它也成为空目录的话，则顺便一并删除

#### touch
修改文件时间信息，或新建文件

#### rm
删除文件或目录，使用 rm 删除成功则无法恢复
```html
$ rm [-ir] file|dir
-i 删除前逐一询问
-r 删除目录及里面的文件，目录必须用次参数
```

#### cp
```$ cp [options] sourcedir destdir``` 复制文件或目录
```html
-a 常用于复制目录，保留链接、文件属性，并复制目录下所有文件
-d 复制时保留链接，链接相当于 win 中的快捷方式
-f 覆盖已存在的目标文件且不提示
-i 覆盖已存在的目标文件前，给与提示
-u 仅复制目标目录中不存在的或是文件内容更新的文件
```

#### scp
远程拷贝，支持跨服务器，并提供加密传输。  
使用 ssh 登陆后本机地址不需要给出。也支持不登录直接跨主机拷贝文件，需要提供用户名和密码。
```sh
$ scp [options] [username@source_ip] source_file [username@remote_ip] dir_file
```

#### mv
```mv [-fi] sourcedir destdir``` 移动目标文件

#### file
确定文件类型

#### less
浏览文件内容,可一页一页显示输出

#### ln
为某文件在另外的位置建立一个同步的链接，不会重复占用磁盘空间
http://www.runoob.com/linux/linux-comm-ln.html
- 硬链接
- 软连接
ln：创建硬链接和符号链接； ln -s 文件名 链接名：符号链接

#### cat
显示文件内容并输出
```html
-n 从 1 开始对输出行进行编号
-b 也是编号，但是空白行不编号
```
把 text1 的文档内容加上行号后输入到 text2 中
```sh
$ cat -n text1 > text2
```

### 文件权限
```
rwx； x：可执行
十个字符；第一个表文件类型，- 普通文件，d 目录；c 字符设备文件， b块设备文件；l 符号链接，权限是虚拟的，真是权限为指向的文件，一直是lrwxrwxrwx
后面分别为owner，group， world的权限
```

#### 1.chmod
```chmod [options] mode file``` 修改文件或目录权限

mode: 权限设置字串，格式为 [ugoa][+-=][rwxX][...]
```
u：文件所有者； g：用户组； o：其他所有人； a：all
+：增加权限； -：取消权限； =：设定唯一权限
```

将文件 file1 与 file2 设为该文件拥有者，与其所属同一个群体者可写入，但其他以外的人则不可写入 
```sh
$ chmod ug+w,o-w file1 file2
```

#### 2. chown
```chown [options] user[:group] file``` 修改文件的属主，可改为其他用户或群组

将文件 file 的所有者设为  users 群组中的 tom 用户
```sh
$ chown tom:users file
```

#### 3. chgrp
```chgrp [options] [所属群组] [file/dir]``` 修改文件或目录的所属群组
 
### 文档编辑
#### 1. wc
```wc [-wlc] filename``` 无参数的话默认输出计算文件的字数、行数、字节数  

-w 只显示字数； -l 只显示行数； -c 只显示 byte 数

## linux 三剑客
### grep
grep : 作用 文本搜索工具，根据用户指定的‘模式’（可以是正则表达式）对目标文件逐步进行匹配检查，打印匹配到的行

grep [options] 字符串 [filepath]

-c 显示符合要求的个数； 
-i 忽略大小写；
-n 输出行号；
-v 反向输出，也就是不匹配的内容； 
-o 只显示被匹配到的字符串；
-f <规则文件> 查找符合指定规则文件的内容，格式为每行一个规则样式；

若希望输出匹配行的前后行： 
- grep 字符串 filepath -A 1 ： 输出除匹配的该行外，还显示其后面一行(After 1)
- grep 字符串 filepath -B 1 ： 输出除匹配的该行外，还显示其前面一行(Before 1)
- grep 字符串 filepath -1 ： 输出除匹配的该行外，还显示前一行和后一行

### awk
用于处理数据和生成报告，更适合文本格式化，对文本进行较复杂的格式处理。

```awk [options] 'pattern{action}' filepath``` ，必须用单引号

-F 指定分隔符，如果有多个分隔符： ```awk -F '[:,]' filepath```

awk 逐行处理文本，处理的最小单位是字段，每个字段的命名方式为：$n，n 为字段号，从 1 开始，$0 表示一整行。

**内建变量：**
```  
$0 整行, $1-$n 第n个字段
NR 已经读出的记录数，即行号，从 1 开始，有多个文件的话值也是不断累加的，用于最后可以输出总共的记录数。
FNR 当前记录数，是每个文件自己的行号
OFS 输出字段分隔符，默认为空格
ORS 输出记录分隔符，默认为换行符
```

**awk 编程结构：**  
```sh
awk 'BEGIN{BEGIN 操作} {文件行处理块} END{END 操作}' filepath
```
pattern 包含两种特殊模式:  
- BEGIN 模块是在文件输入前执行的，不输入任何文件数据也会执行该模块，常用于设置修改内置变量如 OFS,RS 等，为用户自定义的变量赋初始值或者打印标题信息等。 操作语句以 ";" 或分行隔开。 可缺省。  
- END 模块是处理完文件后的操作

**重定向：**    
符号与 shell 相同； 目标文件必须用双引号括起；目标文件打开就一直保持打开状态，显式关闭或 awk 程序终止。

awk 每次只能打开打开一个管道，管道右边的命令必须用双引号括起。


查看最近 5 条登录用户和 ip 地址
```sh
$ last -n 5 | awk '{print $1"\t"$3}'
```

过滤文本，查看 /etc/passwd 文件
```sh
$ awk -F ":" '{print NR, $1, $5, $6}' OFS="\t" /etc/passwd
```

字符串匹配，~ 表示模式开始，/pattern/ 中间是模式， ```|| NR==1``` 打印出第一行（有时候是想打印表头），用 !~ // 表示模式取反
```sh
awk -F ":" '$1 ~/er/ || NR==1 {print NR, $1, $5, $6}' OFS="\t" /etc/passwd
```

拆分文件，使用重定向，输出
```sh
awk -F ":" '{if($1 ~/yi/) print > "1.txt"; else print > "2.txt"}' passwd
```

统计，统计每个用户的进程占了多少内存（计算 RSS 列）
```sh
ps aux | awk 'NR!=1{a[$1]+=$6;} END {for (i in a) print i "," a[i]"KB";}'
```

python 编程
```python
instance_id = os.popen('grep \"Log view:\" %s -A 1| awk -F "&" \'{print $3}\' | awk -F "=" \'{print $2}\' | awk \'{if($0!="") print}\'' % job_trace_log_file).readlines()
```

### sed
stream editor , 流编辑器，是一个文本编辑工具，实现数据的替换，删除，增加，选取等(以行为单位进行处理)

```sed [-nefri] '动作'```

-f<script文件> 将 sed 动作写在文件内，以指定的 script 来处理输入的文本
-i 直接修改读取的文件内容，不输出到终端，也可选择将修改重定向到一个新的文件

动作说明：
s 替换命令，搭配正则表达式，如 's/old/new/g'

在每行最前面或最后面添加 #
```sh
sed 's/^/#/g' filepath
sed 's/$/#/g' filepath
```

指定需要替换的内容，允许多个匹配，用分号隔开
```sh
sed '3s/old/new/g' filepath # 替换第 3 行的
sed '3,6s/old/new/g' filepath # 替换第 3-6 行的
sed 's/old/new/1' filepath # 替换每行的第一个
sed 's/old/new/3g; xxx' filepath # 替换每行的第三个以后的
```

使用 & 表示被匹配的变量，在周围添加内容
```sh
sed 's/my/[&]/g' filepath # 将所有的 my 变为 [my]
```

## 进程管理
### 查看进程
#### 1. ps
```
空 显示自己的进程；
-a 显示现行终端下的所有进程，包括其他用户的进程；
-A 所有进程都显示，相当于 -e；
-u 以用户为主的进程状态；
x 通常与 -a 一起用，列出较完整的信息；
-l 显示较详细的信息
```

查看系统所有进程
```sh
$ ps aux
```
查看特定进程
```sh
$ ps aux | grep xxx
```

#### 2. pstree
显示进程树，即用树状图形式显示进程。 -p 显示 pid

#### 3. top
可以查看系统的 cpu、内存、运行时间、交换分区、执行的线程等。能够有效发现系统的缺陷在哪。
可以实时显示进程信息，可用于监控 linux 的系统状况

- 第一行 load average 后面有三个数字，显示距离现在 1、5、15 分钟的负载情况，数值除以逻辑 cpu 的数量，结果高于 5 则表明系统在超负荷运转。  
- 第三行 ```%Cpu(s): 13.7 us,  1.5 sy,  0.0 ni, 84.2 id,  0.6 wa,  0.0 hi,  0.0 si,  0.0 st```
```
us: user 用户空间占用 cpu 的百分比 
sy: system 内核空间占用 cpu 的百分比 
ni: niced 改变过优先级的进程占用 cpu 的百分比 
id: 空闲 cpu 百分比 
wa: IO wait IO 等待占用 cpu 的百分比 
hi: Hardware IRQ 硬中断占用 cpu 的百分比 
si: software 软中断占用 cpu 的百分比 
st: 被 hypervisor 偷去的时间
```
- 第四行为内存状态
- 第五行为 swap 交换分区
- 第七行是各进程的监控
```
PR： 进程优先级 
NI： nice 值。负值表示高优先级，正值表示低优先级 
VIRT： 进程使用的虚拟内存总量，VIRT = SWAP + RES 
RES： 进程使用的、未被换出的物理内存大小，RES = CODE + DATA 
SHR： 共享内存大小
S： 进程状态。 D = 不可中断的睡眠状态，R = 运行，S = 睡眠，T = 跟踪/停止，Z = 僵尸进程 
%CPU： 上次更新到现在的CPU时间占用百分比
%MEM： 进程使用的物理内存百分比 
TIME+： 进程使用的CPU时间总计
COMMAND： 进程名称（命令名/命令行）
```

#### 4. netstat
显示各种网络相关信息，如网络连接、路由表、接口状态等。
```
-a 显示所有选项（包括 listen）；
-t 仅显示 tcp 相关； 
-u 仅显示 udp 相关；
-l 仅列出有在 listen 的服务状态；
-n 拒绝显示别名（显示数字）；
-p 显示建立相关连接的程序名
```

查看占用 80 端口的进程信息
```sh
$ netstat -anp | grep 80
```

### 后台运行
```
&：命令后加&，后台运行
bg %1 ： 将1号进程移到后台
fg %1：移到前台
```

### 孤儿进程和僵尸进程
子进程和父进程的运行是异步过程，即父进程永远无法预测子进程何时结束。当子进程完成工作终止后，父进程需要调用 wait() 或 waitpid() 系统取得子进程的终止状态。

#### 孤儿进程
- 一个父进程退出，而他的子进程还在运行，那么这些子进程将成为孤儿进程。
- 孤儿进程没有父进程，会被 init 进行（pid=1）收养，并由 init 进程对他们完成状态收集工作。 
- 孤儿进程不会对系统造成危害。

#### 僵尸进程
- 一个进程使用 fork 创建子进程，如果子进程退出，而父进程没有调用 wait() 或 waitpid() 获取子进程的状态信息，那子进程的进程描述符仍保留在系统中，成为僵尸进程。
- 子进程在 exit() 后并非马上消失，而是留下一个僵尸进程(zombie)的数据结构，等待父进程处理。若父进程没来得及处理，用 ps 查看子进程会显示状态 “Z”
- 系统能使用的进程号有限，如果产生大量僵尸进程，就可能因为没有可用进程号而不能产生新进程。
- 消灭僵尸进程： kill 父进程，那僵尸进程将变为孤儿进程，由 init 收养，init 会释放僵尸进程占用的资源。

### 系统管理
#### 用户管理
```
useradd xxx：添加用户
passwd xxx： 为新用户设置密码
userdel xxx：删除用户
logout：注销当前用户
```

### 磁盘管理
Linux磁盘管理常用三个命令为 df、du 和 fdisk。
```
df：列出文件系统的整体磁盘使用量
du：检查磁盘空间使用量
fdisk：用于磁盘分区
```

#### 1. df
检查文件系统的磁盘空间占用情况，可以获取硬盘被占用了多少空间，目前还剩多少空间等信息。
```sh 
$ df [-ahikHTm] [目录或文件名]
-a ：列出所有的文件系统，包括系统特有的 /proc 等文件系统；
-h ：以人们较易阅读的 GBytes, MBytes, KBytes 等格式自行显示；
-T ：显示文件系统类型, 连同该 partition 的 filesystem 名称 (例如 ext3) 也列出；
```

#### 2. du
du 命令是对文件和目录磁盘使用的空间的查看
```sh
$ du [-ahskm] 文件或目录名称
```

#### 3. fdisk
fdisk [-l] 装置名称  是磁盘分区表操作工具
-l ：输出后面接的装置所有的分区内容。若仅有 fdisk -l 时， 则系统将会把整个系统内能够搜寻到的装置的分区均列出来。

#### 4. mount
磁盘挂载使用 mount 命令，卸载使用 umount 命令。
mount [-t 文件系统] [-L Label名] [-o 额外选项] [-n]  装置文件名  挂载点
```sh
# 将 /dev/hdc6 挂载到 /mnt/hdc6 上面
$ mount /dev/hdc6 /mnt/hdc6
```






### 过滤器
sort： 可以改变输出结果，生成一个有序列表
uniq： 报道或忽略重复行，接受数据有序列表，常与sort连用; 输出重复的行，加上 -d
如 ls /bin /usr/bin | sort | uniq | less
wc： 显示文件包含的行数、字数和字节数； wc -l ：只显示行数
head/tail ： 默认打印文件开头/结尾的十行； -n x：控制打印x行； -f：检测文件变化，有新内容会显示在屏幕上



wget 地址：下载文件
tar -zxvf xxx：解压； ./configure ； make ； make install
tough filename：新建文件；vi filename：新建并编辑

linux字符类 [:alnum:] 任意一个字母或数字; [:alpha:]; [:digit:]; [:lower:]; [:upper:]
例： \*[[:lower:]123] 文件名以小写字母结尾，或以1 2 3结尾的文件
两次tab键 ： 显示自动补全列表
history：显示历史命令； history | grep /usr/bin ： 显示包含/usr/bin的历史命令

~ ： 显示目录

ctrl+a ： 光标移到行首； ctrl+e ： 光标移到行尾
文本编辑
ctrl+d ： 删除光标位置的字符

### 其他
#### 1. rsync
数据镜像备份工具，用于文件同步和数据传输，可将客户机和远程文件服务器之间的文件同步。
rsync -zr --progress 10.77.29.68::backup/weiflow/xxx
-z 传输时对数据压缩
-r 对子目录递归
--progress 显示数据镜像同步过程



### 文件系统

### 

工作常用： grep find sed curl wget tr 管道 tail head vim tmux